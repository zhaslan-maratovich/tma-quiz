# Техническое задание

## Telegram Mini App: Конструктор тестов и опросов

---

## 1. Общее описание продукта

### 1.1 Назначение

Telegram Mini App для создания и прохождения интерактивных тестов и опросов. Позволяет владельцам Telegram-каналов создавать красивые тесты, делиться ими с аудиторией и собирать аналитику по ответам.

### 1.2 Целевая аудитория

| Роль          | Описание                                         | Потребность                                      |
| ------------- | ------------------------------------------------ | ------------------------------------------------ |
| **Создатель** | Владелец Telegram-канала, блогер, SMM-специалист | Вовлечение аудитории через интерактивный контент |
| **Участник**  | Подписчик канала, пользователь Telegram          | Развлечение, самопознание, участие в опросах     |

### 1.3 Платформа

- Telegram Mini App (TMA)
- Работает внутри Telegram на всех устройствах (iOS, Android, Desktop, Web)

### 1.4 Основной сценарий использования

```
Создатель                          Участник
    │                                  │
    ▼                                  │
Открывает TMA                          │
    │                                  │
    ▼                                  │
Создаёт тест                           │
    │                                  │
    ▼                                  │
Публикует                              │
    │                                  │
    ▼                                  │
Получает ссылку                        │
    │                                  │
    ▼                                  │
Шерит в канал/чат ──────────────────►  │
                                       ▼
                              Открывает ссылку
                                       │
                                       ▼
                              Проходит тест в TMA
                                       │
                                       ▼
                              Видит результат
                                       │
                                       ▼
                              Шерит результат (картинка)
```

---

## 2. Функциональные требования

### 2.1 Типы тестов

#### 2.1.1 Branching Story (Разветвлённый сюжет)

| Параметр    | Описание                                                                      |
| ----------- | ----------------------------------------------------------------------------- |
| Структура   | Древовидная: каждый ответ ведёт к определённому следующему вопросу или финалу |
| Логика      | Нет правильных ответов, путь определяется выборами                            |
| Финал       | Один из нескольких финальных экранов (зависит от пути)                        |
| UI создания | Список вопросов + у каждого ответа выбор \"куда ведёт\"                       |

#### 2.1.2 Quiz Classic (Викторина с правильными ответами)

| Параметр  | Описание                                                        |
| --------- | --------------------------------------------------------------- |
| Структура | Линейная: все вопросы по порядку                                |
| Логика    | У каждого вопроса один правильный ответ                         |
| Финал     | Экран с результатом: \"X из Y правильно\" + разбор всех ответов |

#### 2.1.3 Quiz Personality (Тест-типология)

| Параметр  | Описание                                                        |
| --------- | --------------------------------------------------------------- |
| Структура | Линейная: все вопросы по порядку                                |
| Логика    | Каждый ответ добавляет очки к одному или нескольким результатам |
| Финал     | Экран результата с максимальным количеством очков               |

### 2.2 Структура теста

```
┌─────────────────────────────────────────────────────────────┐
│                      СТРУКТУРА ТЕСТА                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────────┐                                       │
│  │  Welcome Screen  │                                       │
│  │  ─────────────── │                                       │
│  │  • Заголовок     │                                       │
│  │  • Описание      │                                       │
│  │  • Картинка (?)  │                                       │
│  │  • Кнопка        │                                       │
│  └────────┬─────────┘                                       │
│           │                                                 │
│           ▼                                                 │
│  ┌──────────────────┐                                       │
│  │    Вопрос 1      │                                       │
│  │  ─────────────── │                                       │
│  │  • Текст         │                                       │
│  │  • Картинка (?)  │                                       │
│  │  • Ответы:       │                                       │
│  │    - Текст       │                                       │
│  │    - Картинка (?)│                                       │
│  └────────┬─────────┘                                       │
│           │                                                 │
│           ▼                                                 │
│          ...                                                │
│           │                                                 │
│           ▼                                                 │
│  ┌──────────────────┐                                       │
│  │  Final Screen(s) │                                       │
│  │  ─────────────── │                                       │
│  │  • Заголовок     │                                       │
│  │  • Описание      │                                       │
│  │  • Картинка (?)  │                                       │
│  │  • Кнопка шеринга│                                       │
│  └──────────────────┘                                       │
│                                                             │
│  (?) — опциональное поле                                    │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 Роли и функции

#### 2.3.1 Создатель

| Функция          | Описание                                           |
| ---------------- | -------------------------------------------------- |
| Авторизация      | Через Telegram (автоматически при открытии TMA)    |
| Создание теста   | Выбор типа, заполнение контента, загрузка картинок |
| Черновики        | Сохранение незавершённых тестов                    |
| Публикация       | Перевод теста из черновика в опубликованный        |
| Список тестов    | Просмотр своих тестов (черновики и опубликованные) |
| Получение ссылки | Копирование ссылки на опубликованный тест          |
| Аналитика        | Просмотр статистики по прохождениям                |
| Удаление         | Удаление своих тестов                              |
| Настройки теста  | Включение/выключение возможности перепрохождения   |

#### 2.3.2 Участник

| Функция             | Описание                            |
| ------------------- | ----------------------------------- |
| Открытие теста      | По ссылке из Telegram               |
| Прохождение         | Ответы на вопросы, навигация        |
| Просмотр результата | Финальный экран по итогам           |
| Шеринг результата   | Генерация картинки + ссылка на тест |
| Перепрохождение     | Если разрешено создателем           |

### 2.4 Аналитика для создателя

| Метрика                      | Описание                              |
| ---------------------------- | ------------------------------------- |
| Всего прохождений            | Количество завершённых тестов         |
| Распределение по вопросам    | % выбора каждого варианта ответа      |
| Распределение по результатам | % получения каждого финального экрана |

### 2.5 Шеринг результата

| Параметр            | Описание                             |
| ------------------- | ------------------------------------ |
| Формат              | Картинка (PNG/WebP) + ссылка на тест |
| Содержимое картинки | Финальный экран с результатом        |
| Генерация           | На сервере                           |

### 2.6 Лимиты и ограничения

| Параметр                 | Значение                      |
| ------------------------ | ----------------------------- |
| Тестов на пользователя   | 20                            |
| Вопросов в тесте         | 50                            |
| Картинок в тесте         | 100                           |
| Размер картинки          | 2 MB (до сжатия)              |
| Формат хранения картинок | WebP (конвертация на сервере) |
| Язык теста               | Один (на выбор создателя)     |

### 2.7 Логика перепрохождения

`
┌─────────────────────────────────────────────────────────────┐
│ allow_retake = false │
├─────────────────────────────────────────────────────────────┤
│ Участник открывает тест повторно: │
│ → Сразу видит свой предыдущий результат │
│ → Статистика НЕ меняется │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ allow_retake = true │
├─────────────────────────────────────────────────────────────┤
│ Участник открывает тест повторно: │
│ → Видит Welcome Screen │
│ → Может пройти заново │
│ → Старый результат ПЕРЕЗАПИСЫВАЕТСЯ │
└─────────────────────────────────────────────────────────────┘
`

### 2.8 Жизненный цикл теста

```
┌─────────┐           ┌───────────┐
│  DRAFT  │ ────────► │ PUBLISHED │
│         │  publish  │           │
└─────────┘           └───────────┘
     │                      │
     │ delete               │ delete
     ▼                      ▼
 [удалён]               [удалён]
```

| Статус    | Редактирование | Прохождение | Аналитика |
| --------- | -------------- | ----------- | --------- |
| Draft     | ✅             | ❌          | ❌        |
| Published | ❌             | ✅          | ✅        |

---

## 3. Техническая архитектура

### 3.1 Стек технологий

#### Frontend

| Технология            | Назначение            |
| --------------------- | --------------------- |
| React 18              | UI framework          |
| TypeScript            | Типизация             |
| Vite                  | Сборка                |
| TanStack Query        | Работа с API          |
| TanStack Router       | Маршрутизация         |
| Tailwind CSS          | Стилизация            |
| Telegram Mini App SDK | Интеграция с Telegram |

#### Backend

| Технология     | Назначение                |
| -------------- | ------------------------- |
| Node.js 20     | Runtime                   |
| TypeScript     | Типизация                 |
| Fastify        | HTTP framework            |
| Prisma         | ORM                       |
| Sharp          | Обработка картинок        |
| Satori + Resvg | Генерация result-картинок |
| Pino           | Логирование               |

#### Data

| Технология            | Назначение                         |
| --------------------- | ---------------------------------- |
| PostgreSQL            | Основная база данных               |
| Redis                 | Кэш, сессии, rate limiting         |
| Yandex Object Storage | Хранение картинок (S3-совместимый) |

### 3.2 Схема инфраструктуры

```
┌─────────────────────────────────────────────────────────────────┐
│                         YANDEX CLOUD                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐       ┌─────────────────────────────────┐     │
│  │  Telegram   │       │          VPS / Container         │     │
│  │   Client    │◄─────►│  ┌─────────┐    ┌─────────────┐ │     │
│  └─────────────┘       │  │ React   │    │  Fastify    │ │     │
│                        │  │ (static)│    │  API        │ │     │
│                        │  └─────────┘    └──────┬──────┘ │     │
│                        └────────────────────────┼────────┘     │
│                                                 │               │
│              ┌──────────────────────────────────┼───────┐      │
│              │                                  │       │      │
│              ▼                                  ▼       ▼      │
│  ┌───────────────────┐  ┌─────────────┐  ┌───────────────┐    │
│  │ Object Storage    │  │ Managed     │  │ Managed       │    │
│  │ (картинки)        │  │ PostgreSQL  │  │ Redis         │    │
│  └───────────────────┘  └─────────────┘  └───────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.3 Схема базы данных

#### 3.3.1 ER-диаграмма

```
users
  │
  ├──< tests
  │      │
  │      ├─── test_welcome_screens (1:1)
  │      │
  │      ├──< questions
  │      │       │
  │      │       └──< answers
  │      │              │
  │      │              └──< answer_result_points
  │      │                          │
  │      ├──< test_results <────────┘
  │      │
  │      └──< user_sessions
  │             │
  │             ├──< user_answers
  │             │
  │             └──< shared_results
  │
  └──< user_sessions (как участник)
```

#### 3.3.2 Таблицы

**users**

| Поле          | Тип           | Описание            |
| ------------- | ------------- | ------------------- |
| id            | UUID PK       | Идентификатор       |
| telegram\*id  | BIGINT UNIQUE | Telegram user ID    |
| username      | VARCHAR(255)  | Username в Telegram |
| first_name    | VARCHAR(255)  | Имя                 |
| last_name     | VARCHAR(255)  | Фамилия             |
| language_code | VARCHAR(10)   | Язык пользователя   |
| created_at    | TIMESTAMPTZ   | Дата создания       |
| updated_at    | TIMESTAMPTZ   | Дата обновления     |

**tests**

| Поле         | Тип                | Описание                           |
| ------------ | ------------------ | ---------------------------------- |
| id           | UUID PK            | Идентификатор                      |
| owner_id     | UUID FK → users    | Создатель                          |
| type         | ENUM               | 'branching', 'quiz', 'personality' |
| status       | ENUM               | 'draft', 'published'               |
| slug         | VARCHAR(50) UNIQUE | URL-идентификатор                  |
| allow_retake | BOOLEAN            | Разрешено ли перепрохождение       |
| created_at   | TIMESTAMPTZ        | Дата создания                      |
| updated_at   | TIMESTAMPTZ        | Дата обновления                    |
| published_at | TIMESTAMPTZ        | Дата публикации                    |

**test_welcome_screens**

| Поле        | Тип                    | Описание      |
| ----------- | ---------------------- | ------------- |
| id          | UUID PK                | Идентификатор |
| test_id     | UUID FK UNIQUE → tests | Тест          |
| title       | VARCHAR(255)           | Заголовок     |
| description | TEXT                   | Описание      |
| image_url   | VARCHAR(500)           | URL картинки  |
| button_text | VARCHAR(50)            | Текст кнопки  |

**questions**

| Поле      | Тип             | Описание      |
| --------- | --------------- | ------------- |
| id        | UUID PK         | Идентификатор |
| test_id   | UUID FK → tests | Тест          |
| order     | SMALLINT        | Порядок       |
| text      | TEXT            | Текст вопроса |
| image_url | VARCHAR(500)    | URL картинки  |

**answers**

| Поле             | Тип                    | Описание                     |
| ---------------- | ---------------------- | ---------------------------- |
| id               | UUID PK                | Идентификатор                |
| question_id      | UUID FK → questions    | Вопрос                       |
| order            | SMALLINT               | Порядок                      |
| text             | VARCHAR(500)           | Текст ответа                 |
| image_url        | VARCHAR(500)           | URL картинки                 |
| next_question_id | UUID FK → questions    | Следующий вопрос (branching) |
| result_id        | UUID FK → test_results | Финал (branching)            |
| is_correct       | BOOLEAN                | Правильный ответ (quiz)      |

**test_results**

| Поле        | Тип             | Описание             |
| ----------- | --------------- | -------------------- |
| id          | UUID PK         | Идентификатор        |
| test_id     | UUID FK → tests | Тест                 |
| title       | VARCHAR(255)    | Заголовок результата |
| description | TEXT            | Описание             |
| image_url   | VARCHAR(500)    | URL картинки         |

**answer_result_points**

| Поле      | Тип                    | Описание         |
| --------- | ---------------------- | ---------------- |
| id        | UUID PK                | Идентификатор    |
| answer_id | UUID FK → answers      | Ответ            |
| result_id | UUID FK → test_results | Результат        |
| points    | SMALLINT               | Количество очков |

**user_sessions**

| Поле         | Тип                    | Описание               |
| ------------ | ---------------------- | ---------------------- |
| id           | UUID PK                | Идентификатор          |
| user_id      | UUID FK → users        | Участник               |
| test_id      | UUID FK → tests        | Тест                   |
| result_id    | UUID FK → test_results | Итоговый результат     |
| score        | SMALLINT               | Баллы (quiz)           |
| max_score    | SMALLINT               | Максимум баллов (quiz) |
| started_at   | TIMESTAMPTZ            | Начало                 |
| completed_at | TIMESTAMPTZ            | Завершение             |

**user_answers**

| Поле        | Тип                     | Описание      |
| ----------- | ----------------------- | ------------- |
| id          | UUID PK                 | Идентификатор |
| session_id  | UUID FK → user_sessions | Сессия        |
| question_id | UUID FK → questions     | Вопрос        |
| answer_id   | UUID FK → answers       | Ответ         |
| answered_at | TIMESTAMPTZ             | Время ответа  |

**shared_results**

| Поле       | Тип                     | Описание      |
| ---------- | ----------------------- | ------------- |
| id         | UUID PK                 | Идентификатор |
| session_id | UUID FK → user_sessions | Сессия        |
| image_url  | VARCHAR(500)            | URL картинки  |
| created_at | TIMESTAMPTZ             | Дата создания |

### 3.4 API Endpoints

#### 3.4.1 Аутентификация

| Method | Endpoint             | Описание                            |
| ------ | -------------------- | ----------------------------------- |
| POST   | `/api/auth/telegram` | Авторизация через Telegram initData |

#### 3.4.2 Тесты (для создателя)

| Method | Endpoint                   | Описание                     |
| ------ | -------------------------- | ---------------------------- |
| GET    | `/api/tests`               | Список своих тестов          |
| POST   | `/api/tests`               | Создать новый тест           |
| GET    | `/api/tests/:id`           | Получить тест по ID          |
| PUT    | `/api/tests/:id`           | Обновить тест (только draft) |
| DELETE | `/api/tests/:id`           | Удалить тест                 |
| POST   | `/api/tests/:id/publish`   | Опубликовать тест            |
| GET    | `/api/tests/:id/analytics` | Аналитика по тесту           |

#### 3.4.3 Вопросы

| Method | Endpoint                               | Описание         |
| ------ | -------------------------------------- | ---------------- |
| GET    | `/api/tests/:testId/questions`         | Список вопросов  |
| POST   | `/api/tests/:testId/questions`         | Добавить вопрос  |
| PUT    | `/api/questions/:id`                   | Обновить вопрос  |
| DELETE | `/api/questions/:id`                   | Удалить вопрос   |
| PUT    | `/api/tests/:testId/questions/reorder` | Изменить порядок |

#### 3.4.4 Ответы

| Method | Endpoint                             | Описание       |
| ------ | ------------------------------------ | -------------- |
| POST   | `/api/questions/:questionId/answers` | Добавить ответ |
| PUT    | `/api/answers/:id`                   | Обновить ответ |
| DELETE | `/api/answers/:id`                   | Удалить ответ  |

#### 3.4.5 Результаты (финальные экраны)

| Method | Endpoint                     | Описание           |
| ------ | ---------------------------- | ------------------ |
| GET    | `/api/tests/:testId/results` | Список результатов |
| POST   | `/api/tests/:testId/results` | Добавить результат |
| PUT    | `/api/results/:id`           | Обновить результат |
| DELETE | `/api/results/:id`           | Удалить результат  |

#### 3.4.6 Прохождение (для участника)

| Method | Endpoint                  | Описание                      |
| ------ | ------------------------- | ----------------------------- |
| GET    | `/api/play/:slug`         | Получить тест для прохождения |
| GET    | `/api/play/:slug/session` | Проверить существующую сессию |
| POST   | `/api/play/:slug/start`   | Начать прохождение            |
| POST   | `/api/play/:slug/submit`  | Отправить все ответы          |

#### 3.4.7 Шеринг

| Method | Endpoint                  | Описание                          |
| ------ | ------------------------- | --------------------------------- |
| POST   | `/api/sessions/:id/share` | Сгенерировать картинку результата |
| GET    | `/api/share/:shareId`     | Получить картинку по ID           |

#### 3.4.8 Загрузка файлов

| Method | Endpoint                | Описание           |
| ------ | ----------------------- | ------------------ |
| POST   | `/api/upload/image`     | Загрузить картинку |
| DELETE | `/api/upload/image/:id` | Удалить картинку   |

#### 3.4.9 Служебные

| Method | Endpoint  | Описание     |
| ------ | --------- | ------------ |
| GET    | `/health` | Health check |

### 3.5 Обработка картинок

```
┌─────────────────────────────────────────────────────────────┐
│  PIPELINE ЗАГРУЗКИ КАРТИНКИ                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Клиент                                                    │
│     │                                                       │
│     ▼ POST /api/upload/image (multipart/form-data)         │
│  ┌─────────┐                                               │
│  │ Fastify │                                               │
│  └────┬────┘                                               │
│       │                                                     │
│       ▼                                                     │
│  ┌─────────────────────────────────────────┐               │
│  │ Валидация                               │               │
│  │ • Размер ≤ 2MB                          │               │
│  │ • Формат: JPG, PNG, GIF, WebP           │               │
│  └────────────────┬────────────────────────┘               │
│                   │                                         │
│                   ▼                                         │
│  ┌─────────────────────────────────────────┐               │
│  │ Sharp                                   │               │
│  │ • Конвертация в WebP                    │               │
│  │ • Сжатие (quality: 80)                  │               │
│  │ • Resize если > 1920px по большей       │               │
│  │   стороне                               │               │
│  └────────────────┬────────────────────────┘               │
│                   │                                         │
│                   ▼                                         │
│  ┌─────────────────────────────────────────┐               │
│  │ Yandex Object Storage                   │               │
│  │ • Путь: /images/{userId}/{uuid}.webp    │               │
│  └────────────────┬────────────────────────┘               │
│                   │                                         │
│                   ▼                                         │
│  Response: { url: \"https://...\" }                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.6 Генерация картинки результата

```
┌─────────────────────────────────────────────────────────────┐
│  PIPELINE ГЕНЕРАЦИИ SHARE-КАРТИНКИ                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  POST /api/sessions/:id/share                              │
│     │                                                       │
│     ▼                                                       │
│  ┌─────────────────────────────────────────┐               │
│  │ Получить данные сессии                  │               │
│  │ • Результат                             │               │
│  │ • Счёт (для quiz)                       │               │
│  └────────────────┬────────────────────────┘               │
│                   │                                         │
│                   ▼                                         │
│  ┌─────────────────────────────────────────┐               │
│  │ Satori                                  │               │
│  │ • React-компонент → SVG                 │               │
│  └────────────────┬────────────────────────┘               │
│                   │                                         │
│                   ▼                                         │
│  ┌─────────────────────────────────────────┐               │
│  │ Resvg                                   │               │
│  │ • SVG → PNG                             │               │
│  └────────────────┬────────────────────────┘               │
│                   │                                         │
│                   ▼                                         │
│  ┌─────────────────────────────────────────┐               │
│  │ Yandex Object Storage                   │               │
│  │ • Путь: /shares/{sessionId}.png         │               │
│  └────────────────┬────────────────────────┘               │
│                   │                                         │
│                   ▼                                         │
│  Response: { imageUrl: \"https://...\", shareUrl: \"...\" }    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.7 Хранение прогресса прохождения

```
┌─────────────────────────────────────────────────────────────┐
│ localStorage: quiz_progress*{slug} │
├─────────────────────────────────────────────────────────────┤
│ { │
│ \"currentQuestionId\": \"uuid\", │
│ \"answers\": [ │
│ { │
│ \"questionId\": \"uuid\", │
│ \"answerId\": \"uuid\" │
│ } │
│ ], │
│ \"startedAt\": \"2024-01-15T10:00:00Z\" │
│ } │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. Нефункциональные требования

### 4.1 Производительность

| Параметр                 | Требование                          |
| ------------------------ | ----------------------------------- |
| Response time API        | < 500ms (p95)                       |
| Загрузка картинки        | < 2s (включая обработку)            |
| Генерация share-картинки | < 3s                                |
| Ожидаемая нагрузка       | 10 тестов/день, 50 прохождений/день |
| Запас                    | x10 от базовой нагрузки             |

### 4.2 Инфраструктура

| Компонент      | Конфигурация             |
| -------------- | ------------------------ |
| VPS            | 2 vCPU, 4GB RAM          |
| PostgreSQL     | Managed, 1 vCPU, 1GB RAM |
| Redis          | Managed, 1GB или на VPS  |
| Object Storage | 10GB                     |

### 4.3 Безопасность

| Угроза               | Защита                                 |
| -------------------- | -------------------------------------- |
| Подделка авторизации | Проверка подписи Telegram initData     |
| SQL injection        | Prisma ORM (параметризованные запросы) |
| XSS                  | React (экранирование по умолчанию)     |
| Спам тестов          | Лимит 20 тестов на пользователя        |
| Спам запросов        | Rate limiting через Redis              |
| Большие файлы        | Лимит 2MB на загрузку                  |

### 4.4 Rate Limiting

| Endpoint          | Лимит                |
| ----------------- | -------------------- |
| Глобально         | 100 req/min на IP    |
| Создание теста    | 20 req/hour на user  |
| Загрузка картинки | 50 req/hour на user  |
| Прохождение       | 200 req/hour на user |

### 4.5 Мониторинг и алерты

| Компонент          | Решение            |
| ------------------ | ------------------ |
| Health check       | Endpoint `/health` |
| Внешний мониторинг | UptimeRobot        |
| Метрики            | Yandex Monitoring  |
| Алерты             | Telegram-бот       |

**Триггеры алертов:**

| Событие           | Условие              |
| ----------------- | -------------------- |
| Сервис недоступен | > 1 минуты           |
| Высокий CPU       | > 80% дольше 5 минут |
| Диск заполнен     | > 80%                |
| Ошибки 5xx        | > 10 в минуту        |

### 4.6 Бэкапы

| Параметр  | Значение                                |
| --------- | --------------------------------------- |
| Частота   | Ежедневно, 03:00 MSK                    |
| Хранение  | 7 дней                                  |
| Метод     | pg_dump                                 |
| Хранилище | Yandex Object Storage (отдельный бакет) |
| Картинки  | Не бэкапятся                            |

### 4.7 Логирование

**Что логируем:**

| Категория      | События                    | Уровень |
| -------------- | -------------------------- | ------- |
| Ошибки         | Все исключения, 5xx        | ERROR   |
| Безопасность   | Неудачный auth, rate limit | WARN    |
| Бизнес-события | Создание теста, публикация | INFO    |
| Прохождения    | Старт, завершение          | INFO    |

**Формат:**

```json
{
  "timestamp": "2024-01-15T10:30:00Z",
  "level": "INFO",
  "event": "test_created",
  "userId": "uuid",
  "testId": "uuid",
  "testType": "quiz",
  "requestId": "uuid",
  "duration": 145
}
```

**Инструменты:**

| Компонент  | Решение              |
| ---------- | -------------------- |
| Библиотека | Pino                 |
| Хранение   | Yandex Cloud Logging |

---

## 5. Этапы разработки

### 5.1 MVP (Фаза 1)

**Срок:** 6-8 недель

**Scope:**

| Компонент         | Функциональность                 |
| ----------------- | -------------------------------- |
| Авторизация       | Telegram initData                |
| Quiz Classic      | Создание, прохождение, результат |
| Картинки          | Загрузка, сжатие, хранение       |
| Базовая аналитика | Счётчик прохождений              |
| Инфраструктура    | Деплой на Yandex Cloud           |

### 5.2 Фаза 2

**Срок:** 4-6 недель после MVP

**Scope:**

| Компонент             | Функциональность                       |
| --------------------- | -------------------------------------- |
| Quiz Personality      | Полная реализация                      |
| Расширенная аналитика | Распределение по ответам и результатам |
| Шеринг результата     | Генерация картинки                     |

### 5.3 Фаза 3

**Срок:** 4-6 недель после Фазы 2

**Scope:**

| Компонент             | Функциональность    |
| --------------------- | ------------------- |
| Branching Story       | Полная реализация   |
| UI конструктора веток | Визуальный редактор |

### 5.4 Фаза 4 (Монетизация)

**Срок:** По результатам предыдущих фаз

**Scope:**

| Компонент           | Функциональность            |
| ------------------- | --------------------------- |
| Платные планы       | Увеличенные лимиты          |
| Новые типы тестов   | По результатам исследований |
| Интеграция платежей | Telegram Payments / другое  |

---

## 6. Приложения

### 6.1 Глоссарий

| Термин      | Определение                            |
| ----------- | -------------------------------------- |
| TMA         | Telegram Mini App                      |
| Создатель   | Пользователь, создающий тесты          |
| Участник    | Пользователь, проходящий тесты         |
| Branching   | Тип теста с разветвлённым сюжетом      |
| Quiz        | Тип теста с правильными ответами       |
| Personality | Тип теста с определением типа личности |
| Сессия      | Одно прохождение теста участником      |
| Результат   | Финальный экран теста                  |

### 6.2 Ссылки

- [Telegram Mini Apps Documentation](https://core.telegram.org/bots/webapps)
- [Fastify Documentation](https://www.fastify.io/)
- [Prisma Documentation](https://www.prisma.io/docs)
- [Yandex Cloud Documentation](https://cloud.yandex.ru/docs)

---

_Документ подготовлен: Январь 2025_
_Версия: 1.0_
